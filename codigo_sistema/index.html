<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Ingressos</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="app">
      <!-- (q0) Estado inicial: Tela de Escolha de Filme -->
      <!-- (q0, 1) ‚Üí q1: Seleciona um filme e vai para escolha de hor√°rio -->
      <div class="screen active" id="filmes">
        <h1>CineMatic</h1>
        <h2>Selecione sua op√ß√£o</h2>
        <div class="filmes-grid">
          <div class="filme-card" onclick="selecionarFilme('Duna 2')">
            <img src="images\callas.png" alt="Duna 2" />
            <h3>Maria Callas</h3>
            <p>2025 ‚Äß Biografia</p>
          </div>
          <div class="filme-card" onclick="selecionarFilme('Superman')">
            <img src="images/superman.jpg" alt="Superman" />
            <h3>Superman</h3>
            <p>2025 ‚Äß A√ß√£o/Fic√ß√£o cient√≠fica</p>
          </div>
          <div class="filme-card" onclick="selecionarFilme('Mickey 17')">
            <img src="images\mickey_17.png" alt="Mickey 17" />
            <h3>Mickey 17</h3>
            <p>2025 ‚Äß Fic√ß√£o cient√≠fica/Aventura</p>
          </div>
          <div
            class="filme-card"
            onclick="selecionarFilme('Demon Slayer - Infinity Castle')"
          >
            <img
              src="images\demon_slayer.jpg"
              alt="Demon Slayer - Infinity Castle"
            />
            <h3>Demon Slayer - Infinity Castle</h3>
            <p>2025 ‚Äß A√ß√£o/Anime</p>
          </div>
          <div class="filme-card" onclick="selecionarFilme('O Contador 2')">
            <img src="images\contador.jpg" alt="O Contador 2" />
            <h3>O Contador 2</h3>
            <p>2025 ‚Äß A√ß√£o/Thriller</p>
          </div>
          <div class="filme-card" onclick="selecionarFilme('Lilo & Stitch')">
            <img src="images\lilo_stitch.png" alt="Lilo & Stitch" />
            <h3>Lilo & Stitch</h3>
            <p>2025 ‚Äß Fic√ß√£o cient√≠fica/Com√©dia</p>
          </div>
          <div
            class="filme-card"
            onclick="selecionarFilme('Five Nights at Freddys 2')"
          >
            <img src="images\five.jpg" alt="Five Nights at Freddy's 2" />
            <h3>Five Nights at Freddy's 2</h3>
            <p>2025 ‚Äß Terror</p>
          </div>
          <div
            class="filme-card"
            onclick="selecionarFilme('Como treinar o seu drag√£o')"
          >
            <img src="images\dragao.jpg" alt="Como treinar o seu drag√£o" />
            <h3>Como treinar o seu drag√£o</h3>
            <p>2025 ‚Äß Fic√ß√£o cient√≠fica/Aventura</p>
          </div>
        </div>
      </div>

      <!-- (q1) Tela de Escolha de Hor√°rio -->
      <!-- (q1, 2) ‚Üí q2: Seleciona o hor√°rio e vai para sele√ß√£o de assentos -->
      <!-- (q1, 7) ‚Üí q0: Bot√£o "Voltar" retorna para sele√ß√£o de filmes -->
      <div class="screen" id="horarios">
        <h2>Selecione o hor√°rio</h2>
        <img
          id="filmeImagem"
          src=""
          alt="Imagem do filme"
          class="imagem-filme"
        />
        <p id="filmeEscolhido"></p>
        <div class="horarios-grid">
          <button onclick="selecionarHorario('14:00')">14:00</button>
          <button onclick="selecionarHorario('16:30')">16:30</button>
          <button onclick="selecionarHorario('19:00')">19:00</button>
          <button onclick="selecionarHorario('21:30')">21:30</button>
        </div>
        <div class="controls">
          <button onclick="voltarParaFilmes()">Voltar</button>
        </div>
      </div>

      <!-- (q2) Tela de Sele√ß√£o de Assentos -->
      <!-- (q2, 3) ‚Üí q3: Avan√ßa para sele√ß√£o de tipo de ingresso -->
      <!-- (q2, 7) ‚Üí q1: Voltar para hor√°rios -->
      <!-- (q2, 8) ‚Üí q0: Cancelar retorna √† sele√ß√£o de filmes -->
      <div class="screen" id="assentos">
        <h2>Selecione seus assentos</h2>
        <img
          id="filmeImagem"
          src=""
          alt="Imagem do filme"
          class="imagem-filme"
        />
        <div class="legenda">
          <span><span class="assento disponivel"></span> Dispon√≠vel</span>
          <span><span class="assento selecionado"></span> Selecionado</span>
          <span><span class="assento ocupado"></span> Ocupado</span>
        </div>
        <div class="grade-assentos" id="gradeAssentos">
          <!-- Os assentos ser√£o gerados via JavaScript -->
        </div>
        <div class="controls">
          <button onclick="goBack()">Voltar</button>
          <button onclick="cancel()">Cancelar</button>
          <button id="btnAvancarAssento" onclick="next()" disabled>
            Avan√ßar
          </button>
        </div>
      </div>

       <!-- (q3) Tela de Tipos de Ingressos -->
      <!-- (q3, 4) ‚Üí q4: Seleciona tipo de ingresso e vai para confirma√ß√£o -->
      <!-- (q3, 7) ‚Üí q2: Voltar para sele√ß√£o de assentos -->
      <!-- (q3, 8) ‚Üí q0: Cancelar retorna √† sele√ß√£o de filmes -->
      <div class="screen" id="tiposIngressos">
        <h2>Selecione o tipo de ingresso</h2>
        <p id="resumoFilmeHorarioAssentos"></p>

        <div class="tipos-ingressos-container">
          <div
            class="ingresso-card"
            onclick="selecionarTipoIngresso('Inteira', 20)"
          >
            <h3>Inteira</h3>
            <p>R$ 20,00</p>
          </div>
          <div
            class="ingresso-card"
            onclick="selecionarTipoIngresso('Meia', 10)"
          >
            <h3>Meia</h3>
            <p>R$ 10,00</p>
          </div>
        </div>

        <div class="controls">
          <button onclick="goBack()">Voltar</button>
          <button onclick="cancelar()">Cancelar</button>
        </div>
      </div>

      <!-- (q4) Tela de Confirma√ß√£o -->
      <!-- (q4, 5) ‚Üí q5: Vai para tela de pagamento -->
      <!-- (q4, 7) ‚Üí q3: Voltar para tipos de ingressos -->
      <!-- (q4, 8) ‚Üí q0: Cancelar volta para sele√ß√£o de filmes -->
      <div class="screen" id="confirmacao">
        <h2>Confirme sua sele√ß√£o</h2>
        <div class="confirmacao-container">
          <ul id="resumoConfirmacao"></ul>
        </div>
        <div class="controls">
          <button onclick="goBack()">Voltar</button>
          <button onclick="cancelar()">Cancelar</button>
          <button onclick="irParaPagamento()">Ir para Pagamento</button>
        </div>
      </div>
      <!-- (q5) Tela de Pagamento -->
      <!-- (q5, 6) ‚Üí q0: Finaliza pagamento e retorna ao in√≠cio -->
      <!-- (q5, 8) ‚Üí q0: Cancelar volta para sele√ß√£o de filmes --><!-- Tela de Pagamento -->
      <div class="screen" id="pagamento">
        <h2>Escolha seu m√©todo de pagamento</h2>

        <div class="metodo-pagamento-container">
          <div
            class="metodo-pagamento-card"
            onclick="selecionarPagamento('credito')"
          >
            <h3>Cart√£o de Cr√©dito</h3>
            <p>Pagamento via cart√£o de cr√©dito</p>
          </div>
          <div
            class="metodo-pagamento-card"
            onclick="selecionarPagamento('debito')"
          >
            <h3>Cart√£o de D√©bito</h3>
            <p>Pagamento via cart√£o de cr√©dito</p>
          </div>
        </div>

        <div id="formPagamento" class="form-container"></div>

        <div class="controls">
          <button onclick="goBack()">Voltar</button>
          <button onclick="cancelar()">Cancelar</button>
          <button onclick="finalizarPagamento()">Concluir Pagamento</button>
        </div>
      </div>
    </div>

    <script>
      function selecionarFilme(nome) {
        localStorage.setItem("filmeSelecionado", nome);
        document.getElementById("filmeEscolhido").innerText = `${nome}`;

        const imagem = imagensFilmes[nome];

        const imgElement = document.getElementById("filmeImagem");
        if (imgElement && imagem) {
          imgElement.src = imagem;
          imgElement.alt = nome;
        }

        if (imagem) {
          localStorage.setItem("imagemFilme", imagem);
        }

        mostrarTela("horarios");
      }

      function selecionarPagamento(tipo) {
        const formPagamento = document.getElementById("formPagamento");

        document
          .querySelectorAll(".metodo-pagamento-card")
          .forEach((el) => el.classList.remove("active"));

        const selectedCard = Array.from(
          document.querySelectorAll(".metodo-pagamento-card")
        ).find((el) => el.innerText.toLowerCase().includes(tipo));
        if (selectedCard) {
          selectedCard.classList.add("active");
        }

        if (tipo === "credito" || tipo === "debito") {
          const pagamentoTitulo =
            tipo === "credito" ? "Cart√£o de Cr√©dito" : "Cart√£o de D√©bito";

          formPagamento.innerHTML = `
      <h3>${pagamentoTitulo}</h3>
      <div class="cartao">
        <input type="text" id="numeroCartao" placeholder="N√∫mero do Cart√£o" />
        <input type="text" id="nomeCartao" placeholder="Nome no Cart√£o" />
        <input type="text" id="validadeCartao" placeholder="Validade (MM/AA)" />
        <input type="text" id="cvvCartao" placeholder="CVV" />
      </div>
    `;

          const numeroCartao = document.getElementById("numeroCartao");
          numeroCartao.addEventListener("input", function () {
            this.value = this.value
              .replace(/\D/g, "") // Remove qualquer n√£o-d√≠gito
              .replace(/(\d{4})(\d{1,4})/, "$1 $2")
              .replace(/(\d{4})(\d{1,4})(\d{1,4})/, "$1 $2 $3")
              .substring(0, 19);
          });

          const validadeCartao = document.getElementById("validadeCartao");
          validadeCartao.addEventListener("input", function () {
            this.value = this.value
              .replace(/\D/g, "")
              .replace(/(\d{2})(\d{1,2})/, "$1/$2")
              .substring(0, 5); 
          });

          const cvvCartao = document.getElementById("cvvCartao");
          cvvCartao.addEventListener("input", function () {
            this.value = this.value
              .replace(/\D/g, "")
              .substring(0, 3);
          });
        }
      }

      function finalizarPagamento() {
        const metodo = document.querySelector(".metodo-pagamento-card.active");
        if (metodo) {
          alert("Por favor, selecione um m√©todo de pagamento.");
          return;
        }

        alert("Compra finalizada com sucesso! üéâ");
        localStorage.clear();
        mostrarTela("filmes");
      }

      const imagensFilmes = {
        "Duna 2": "images/callas.png",
        Superman: "images/superman.jpg",
        "Mickey 17": "images/mickey_17.png",
        "Demon Slayer - Infinity Castle": "images/demon_slayer.jpg",
        "Kung Fu Panda 4": "images/contador.jpg",
        "Lilo & Stitch": "images/lilo_stitch.png",
        "Five Nights at Freddys 2": "images/five.jpg",
        "Como treinar o seu drag√£o": "images/dragao.jpg",
      };

      function carregarTelaAssentos() {
        const selectedMovie = localStorage.getItem("filmeSelecionado");
        const selectedHorario = localStorage.getItem("horarioSelecionado");
        const occupiedSeats = ["A2", "A3", "B5", "C1"]; // Mock
        const rows = ["A", "B", "C", "D", "E"];
        const cols = [1, 2, 3, 4, 5, 6, 7, 8];
        let selectedSeats = [];

        const assentosDiv = document.createElement("div");
        assentosDiv.className = "screen active";
        assentosDiv.id = "assentos";

        let gridHTML = `
      <h2>Selecione seus assentos</h2>
      <p><strong>${selectedMovie}</strong> - ${selectedHorario}</p>
      <div class="legenda">
        <span><span class="assento disponivel"></span> Dispon√≠vel</span>
        <span><span class="assento selecionado"></span> Selecionado</span>
        <span><span class="assento ocupado"></span> Ocupado</span>
      </div>
      <div class="grade-assentos">
        <div class="screen-label">TELA AQUI</div>
        <div class="seats-grid">
    `;

        rows.forEach((row) => {
          cols.forEach((col) => {
            const seatId = `${row}${col}`;
            const isOccupied = occupiedSeats.includes(seatId);
            gridHTML += `
          <div 
            class="seat ${isOccupied ? "ocupado" : ""}" 
            data-seat="${seatId}" 
            ${isOccupied ? 'data-disabled="true"' : ""}
          >${seatId}</div>
        `;
          });
        });

        gridHTML += `
        </div>
      </div>
      <div class="controls">
        <button onclick="cancelar()">Cancelar</button>
        <button onclick="goBack()">Voltar</button>
        <button id="btnAvancarAssento" disabled onclick="next()">Avan√ßar</button>
      </div>
    `;

        assentosDiv.innerHTML = gridHTML;
        const existente = document.getElementById("assentos");
        if (existente) {
          existente.remove();
        }

        document.getElementById("app").appendChild(assentosDiv);

        document.querySelectorAll(".seat:not(.ocupado)").forEach((seat) => {
          seat.addEventListener("click", () => {
            const seatId = seat.getAttribute("data-seat");
            if (selectedSeats.includes(seatId)) {
              selectedSeats = selectedSeats.filter((s) => s !== seatId);
              seat.classList.remove("selecionado");
            } else {
              selectedSeats.push(seatId);
              seat.classList.add("selecionado");
            }

            localStorage.setItem(
              "assentosSelecionados",
              JSON.stringify(selectedSeats)
            );
            document.getElementById("btnAvancarAssento").disabled =
              selectedSeats.length === 0;
          });
        });
      }

      function selecionarHorario(horario) {
        localStorage.setItem("horarioSelecionado", horario);
        mostrarTela("assentos");
      }

      function voltarParaFilmes() {
        mostrarTela("filmes");
      }

      function goBack() {
        mostrarTela("horarios");
      }

      function cancelar() {
        if (confirm("Deseja cancelar sua compra?")) {
          localStorage.clear();
          alert("Processo cancelado.");
          mostrarTela("filmes");
        }
      }

      function mostrarTela(id) {
        document
          .querySelectorAll(".screen")
          .forEach((tela) => tela.classList.remove("active"));

        if (id === "assentos") {
          carregarTelaAssentos();
        } else {
          document.getElementById(id).classList.add("active");
        }
      }

      function next() {
        mostrarTela("tiposIngressos");

        const filme = localStorage.getItem("filmeSelecionado");
        const horario = localStorage.getItem("horarioSelecionado");
        const assentos =
          JSON.parse(localStorage.getItem("assentosSelecionados")) || [];

        document.getElementById(
          "resumoFilmeHorarioAssentos"
        ).innerText = `Filme: ${filme} | Hor√°rio: ${horario} | Assentos: ${assentos.join(
          ", "
        )}`;
      }

      function selecionarTipoIngresso(tipo, valor) {
        localStorage.setItem("tipoIngresso", tipo);
        localStorage.setItem("valorIngresso", valor);
        mostrarTela("confirmacao");
        preencherConfirmacao();
      }

      function atualizarTotalIngressos() {
        const qtdInteira =
          parseInt(document.getElementById("inteira").value) || 0;
        const qtdMeia = parseInt(document.getElementById("meia").value) || 0;
        const totalSelecionado = qtdInteira + qtdMeia;

        const assentosSelecionados =
          JSON.parse(localStorage.getItem("assentosSelecionados")) || [];
        const qtdAssentos = assentosSelecionados.length;

        const aviso = document.getElementById("avisoQtdAssentos");
        const botaoAvancar = document.getElementById("btnConfirmarIngressos");

        if (totalSelecionado === qtdAssentos) {
          aviso.innerText = "";
          botaoAvancar.disabled = false;
        } else {
          aviso.innerText = `Voc√™ selecionou ${qtdAssentos} assentos, mas est√° escolhendo ${totalSelecionado} ingressos.`;
          botaoAvancar.disabled = true;
        }
      }

      function preencherConfirmacao() {
        const filme = localStorage.getItem("filmeSelecionado");
        const horario = localStorage.getItem("horarioSelecionado");
        const assentos =
          JSON.parse(localStorage.getItem("assentosSelecionados")) || [];
        const tipoIngresso = localStorage.getItem("tipoIngresso");
        const valorUnitario =
          parseFloat(localStorage.getItem("valorIngresso")) || 0;
        const imagem = localStorage.getItem("imagemFilme");

        const quantidadeAssentos = assentos.length;
        const valorTotal = valorUnitario * quantidadeAssentos;

        const resumo = document.getElementById("resumoConfirmacao");
        const imagemFilme = document.getElementById("filmeImagem");

        if (imagem) {
          imagemFilme.src = imagem;
          imagemFilme.alt = "Imagem do filme " + filme;
        } else {
          imagemFilme.src = "caminho/para/imagem/default.jpg";
          imagemFilme.alt = "Imagem padr√£o";
        }

        resumo.innerHTML = `
    <div class="confirmar">
        <strong>Filme:</strong> ${filme} <br>
        <strong>Hor√°rio:</strong> ${horario} <br>
        <strong>Assentos:</strong> ${assentos.join(", ")} <br>
        <strong>Tipo de Ingresso:</strong> ${tipoIngresso} <br>
        <strong>Valor:</strong> R$ ${valorTotal.toFixed(2).replace(".", ",")}
    </div>
  `;
      }

      function irParaPagamento() {
        mostrarTela("pagamento");
      }

      function finalizarCompra() {
        const inteira = parseInt(document.getElementById("inteira").value) || 0;
        const meia = parseInt(document.getElementById("meia").value) || 0;

        localStorage.setItem("ingressos", JSON.stringify({ inteira, meia }));

        alert("Compra finalizada com sucesso! üéâ");
        localStorage.clear();
        mostrarTela("filmes");
      }
    </script>
  </body>
</html>
